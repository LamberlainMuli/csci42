{% extends 'base.html' %}
{% load static crispy_forms_tags %}
{% block content %}
<main class="container mt-4">
  <header>
    <h1>Your Cart</h1>
    <hr>
  </header>
  
  {% if cart.cart_items.count == 0 %}
    <p>Your cart is empty.</p>
    <a href="{% url 'marketplace:home' %}" class="btn btn-secondary" aria-label="Continue Shopping">
      <i class="fas fa-home"></i> Continue Shopping
    </a>
  {% else %}
    <section aria-label="Cart Summary" class="mb-3">
      <p>Total items: <strong>{{ cart.total_items }}</strong></p>
      <p>Total price: <strong>₱{{ cart.total_price|floatformat:2 }}</strong></p>
    </section>
    <section>
      <table class="table table-striped table-responsive" aria-label="Cart Items">
        <thead class="thead-light">
          <tr>
            <th>Product</th>
            <th>Quantity</th>
            <th>Price Each</th>
            <th>Subtotal</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for item, form in item_forms %}
          <tr>
            <td>
              {% if item.product.images.first %}
                <img src="{{ item.product.images.first.image.url }}" alt="{{ item.product.title }}" class="img-thumbnail" style="max-width: 80px;">
              {% else %}
                <img src="/static/images/placeholder.png" alt="No image" class="img-thumbnail" style="max-width: 80px;">
              {% endif %}
              <br>
              {{ item.product.title }}
            </td>
            <td>
              <form method="POST" class="form-inline" novalidate>
                {% csrf_token %}
                <input type="hidden" name="item_id" value="{{ item.id }}">
                {{ form.quantity|as_crispy_field }}
                <button type="submit" class="btn btn-sm btn-primary ml-2" aria-label="Update Quantity">
                  <i class="fas fa-sync-alt"></i>
                </button>
              </form>
            </td>
            <td>₱{{ item.product.price|floatformat:2 }}</td>
            <td>₱{{ item.subtotal|floatformat:2 }}</td>
            <td>
              <a href="{% url 'cart:remove_from_cart' item.id %}" class="btn btn-sm btn-danger" aria-label="Remove item">
                <i class="fas fa-trash-alt"></i>
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </section>
    <section class="mt-3">
      <a href="{% url 'cart:checkout' %}" class="btn btn-success btn-lg" aria-label="Proceed to Checkout">
        Proceed to Checkout <i class="fas fa-arrow-right"></i>
      </a>
      <a href="{% url 'marketplace:home' %}" class="btn btn-secondary ml-2" aria-label="Continue Shopping">
        <i class="fas fa-home"></i> Continue Shopping
      </a>
    </section>
  {% endif %}
</main>
{% endblock %}
